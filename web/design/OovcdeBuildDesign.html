<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>
<!-- DC Blaha  -->

<head>
<link rel="stylesheet" type="text/css" href="../style.css">
<meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">
<title>Oovcde Build Design</title>
</head>

<body>
<h2><a class="mozTocH2" name="mozTocId713890"></a>Oovcde Builder Design</h2>

Created: Jan 10, 2014<br>
Modified: May 16, 2015<br><br>
<ol id="mozToc"><!--mozToc h1 1 h2 2 h3 3 h4 4 h5 5 h6 6-->
<li><a href="#mozTocId713890">Oovcde Builder Design</a>

<ol><li><ol><li><a href="#mozTocId260876">Tasks performed by Oovcde</a></li><li><a href="#mozTocId61087">Tasks performed by OovBuilder</a><ol><li><a href="#mozTocId881209">Check build configurations</a></li><li><a href="#mozTocId585509">Scan external directories</a></li><li><a href="#mozTocId667796">Scan project directories</a></li><li><a href="#mozTocId498575">Pre-Build Cleanup</a></li><li><a href="#mozTocId393616">Analyze</a></li><li><a href="#mozTocId470900">Determine Component and Package Dependencies</a></li><li><a href="#mozTocId275790">Build object files</a></li><li><a href="#mozTocId841934">Build library files</a></li><li><a href="#mozTocId948888">Build executables</a></li></ol></li><li><a href="#mozTocId510071">Tasks performed by OovCppParser</a><ol><li><a href="#mozTocId982586">Scan project source</a></li></ol></li><li><a href="#mozTocId172113">Need to fix</a></li><li><a href="#mozTocId260876">Other optimizations</a></li></ol></li></ol></li></ol><br><h3><a class="mozTocH3" name="mozTocId260876"></a>Tasks performed by Oovcde</h3>This document describes a sequence starting without any preexisting oovcde project files or any type of make files. The Oovcde program performs the following tasks.<br><ul><li>Search the system directories to find build tools</li><li>Fill some build argument options depending on build tools</li><li>When an Oovcde project is created, the user specifies the root directory of the project source code.<br></li><li>Allow the user to specify external packages or external root directories that define include and library files. The user must specify the packages or root directories in the correct dependency order if they have dependencies.</li><li>After analysis is performed, the user can set up component types. The component type
specifies what output will be produces such as a libraries, executable
programs, etc.</li><li>Allow the user to build different build configurations. Examples of build configurations are Debug and Release.<br></li></ul><span style="font-weight: bold;">Output:</span><br><br><table style="text-align: left; width: 666px; height: 260px;" border="1" cellpadding="2" cellspacing="2"><tbody><tr><td style="vertical-align: top;">File<br></td><td style="vertical-align: top;">Content<br></td></tr><tr><td style="vertical-align: top;">oovcde.txt<br></td><td style="vertical-align: top;"><ul><li>Project source root directory<br></li><li>Tools for each build configuration<br></li><li>Arguments specific to each build configuration<br></li></ul></td></tr><tr><td style="vertical-align: top;">oovcde-pkg.txt<br></td><td style="vertical-align: top;">Defines every external package (-EP) used by the project. Each package defines:<br><ul><li>Include directories</li><li>Library directories</li><li>Library names</li><li>External reference directories (-ER)<br></li></ul></td></tr><tr><td style="vertical-align: top;">oovcde-comptypes.txt<br></td><td style="vertical-align: top;">See the section "Scan project directories" for the contents. Oovcde is typically used to set up the component types after the project directory has been scanned.<br></td></tr></tbody></table><h3><a class="mozTocH3" name="mozTocId61087"></a>Tasks performed by OovBuilder</h3>The OovBuilder uses the output from the Oovcde program as inputs to define the build.&nbsp; These input files are fairly simple text files, and could potentially be generated by another tool.&nbsp; The OovBuilder command line arguments are simply the Oovcde project directory, and the -bld-&lt;configuration&gt;, where the &lt;configuration&gt; is "Debug" or "Release".&nbsp; There is also a -v flag for verbose output.<br><br>OovBuilder calculates CRC's for sets of build arguments so that unique configurations of build data are regenerated whenever the
arguments are changed. This allows switching between build configurations quickly while retaining data.<br><h4><a class="mozTocH4" name="mozTocId881209"></a>Check build configurations</h4>Calculate CRC's for the project arguments, so that when the
arguments are changed, stale data can be discarded.<br><br>See the&nbsp;<a href="#BuildCRCs">Build CRC's</a> section for the types of CRC's that are created and compared.<br><br><span style="background-color: rgb(204, 204, 204);"></span><span style="background-color: rgb(204, 204, 204);">[WARNING: At this time, all external project directories are considered non-volatile, user has to erase project analysis contents (including oovcde-buildconfig.txt and oovcde-buildpkg.txt) manually if the contents change in a way that will change include or library dependencies.]<br></span><span style="background-color: rgb(204, 204, 204);">[OPTIMIZE: The project could specify volatile or non-volatile external directories.]</span><span style="font-weight: bold; background-color: rgb(204, 204, 204);"></span><span style="background-color: rgb(204, 204, 204);"></span><br style="background-color: rgb(204, 204, 204);"><br><h4><a class="mozTocH4" name="mozTocId585509"></a>Scan external directories</h4>Scanning the external directories is only done if the "External" config is different for the current build configuration. 
Search external directories for include and lib files. Recusively uses path pattern to create include and library paths.<br>
<br>Note that the compiler will automatically search some include paths. These external paths do not have to be specified to Oovcde. See the Oovcde user guide for more information.<br><span style="background-color: rgb(204, 204, 204);"></span><br><br><span style="font-weight: bold;">Output:</span><br><table style="text-align: left; width: 654px; height: 41px;" border="1" cellpadding="2" cellspacing="2"><tbody><tr><td style="vertical-align: top;">File<br></td><td style="vertical-align: top;">Content<br></td></tr><tr><td style="vertical-align: top;">oovcde-rootdir.txt</td><td style="vertical-align: top;">Defines every external directory (-ER) used by the project. Each package defines:<br>
<ul><li>Include directories</li><li>Library paths (directory and file name)<br></li></ul>
</td></tr></tbody></table><br><span style="background-color: rgb(204, 204, 204);">WARNING - The analysis directories are not kept unique for the clang
and GCC compilers. Only arguments are used to make unique analysis
directories. If they are using the same directory and the include dependencies must be created differently, set an argument that
is different.</span><br style="background-color: rgb(204, 204, 204);"><h4><a class="mozTocH4" name="mozTocId667796"></a>Scan project directories</h4>
Search project for source and include files. Recusively create include and library paths.<br><br><span style="font-weight: bold;">Output:</span><br>
<table style="text-align: left; width: 652px; height: 184px;" border="1" cellpadding="2" cellspacing="2">
  <tbody>
    <tr>
      <td style="vertical-align: top;">File<br>
      </td>
      <td style="vertical-align: top;">Content<br>
      </td>
    </tr>
    <tr><td style="vertical-align: top;">oovcde-comptypes</td><td style="vertical-align: top;"><ul><li>Component names</li><li>Component types</li><li>Source files defined in each component (used by oovcde to display component tree)<br>
  </li></ul>
</td></tr><tr>
      <td style="vertical-align: top;">analysis-&lt;crc&gt;/oovcde-comps.txt</td>
      <td style="vertical-align: top;"><ul><li>
      All include directories in the project<br></li></ul></td>
    </tr>
  </tbody>
</table>
<br><br><span style="background-color: rgb(204, 204, 204);">[OPTIMIZE: unused components remain in the oovcde-buildconfig.txt file, but they do not cause any harm.]<br><br></span><h4><a class="mozTocH4" name="mozTocId498575"></a><span style="background-color: rgb(204, 204, 204);">Pre-Build Cleanup</span></h4>Check the CRC's of arguments to detect changes.<br><ul><li>If the analysis crc doesn't match any
configuration, create a new directory named analysis-&lt;crc&gt;.</li><li>If the analysis or other options changed, delete the *.o files.<br>
  </li><li>If the link options changed, delete the output directory.</li></ul><span style="background-color: rgb(204, 204, 204);"></span><h4><a class="mozTocH4" name="mozTocId393616"></a>Analyze<br></h4>If any analysis files are out of date compared to the inputs, they are recreated. Analysis of each file is performed by a different thread and process, up to the number of cores or processors in the system.<br>If the analysis
content does not exist, create an analysis-&lt;crc&gt; directory for
the XMI files, oovcde-incdeps.txt and&nbsp; oovcde-comps.txt file.Each time a build is performed, the following CRC's are saved.<br><br><span style="font-weight: bold;">Output:<br></span><a name="BuildCRCs"></a><span style="font-weight: bold;">Build CRC's</span><br><table style="text-align: left; width: 650px; height: 252px;" border="1" cellpadding="2" cellspacing="2"><tbody><tr><td style="vertical-align: top;">File<br></td><td style="vertical-align: top;">Content<br></td></tr><tr><td style="vertical-align: top;">oovcde-buildconfig.txt<br></td><td style="vertical-align: top;"><span style="font-weight: bold;"></span>Each build configuration has the following CRC's along with the text used to produce the CRC's.<br><ul><li>Analysis - This combined from the "External" and the "Project"</li><li>External (-ER)<br></li><li>Project - All include directories in the project<br></li><li>Link Arguments (From cppArgs)(-lnk, -L, -l, also from -EP link args)<br></li><li>Other Arguments - All other arguments not covered by above. This includes -EP compile arguments.<br></li></ul></td></tr><tr><td style="vertical-align: top;">analysis-&lt;crc&gt;/*.xmi</td><td style="vertical-align: top;">OovBuilder invokes oovCppParser to build these files. See oovCppParser section.<br></td></tr><tr><td style="vertical-align: top;">analysis-&lt;crc&gt;/oovcde-incdeps</td><td style="vertical-align: top;">OovBuilder invokes oovCppParser to build these files. See oovCppParser section.<br></td></tr></tbody></table><br><br><span style="background-color: rgb(204, 204, 204);">[WARNING: At this time, all external directories are considered non-volatile]</span><span style="background-color: rgb(204, 204, 204);"></span><br><br><h4><a class="mozTocH4" name="mozTocId470900"></a><span style="background-color: rgb(204, 204, 204);">Determine Component and Package Dependencies</span></h4>The include dependencies are used to determine which components are dependent on which packages.&nbsp; This is done before compilation, because some packages have compiler flags that are used to create the object files.<br><br><span style="background-color: rgb(204, 204, 204);"></span><h4><a class="mozTocH4" name="mozTocId275790"></a>Build object files</h4>Build object files for all components not marked as Unknown. Determine the include paths and order by examining the include dependencies. Only build files if they are older than the files they are dependent on.<br><br><span style="background-color: rgb(204, 204, 204);">[OPTIMIZE: Do not recursively check files that have not been modified]</span><br style="background-color: rgb(204, 204, 204);"><span style="background-color: rgb(204, 204, 204);">[OPTIMIZE: Use more threads]</span><br style="background-color: rgb(204, 204, 204);"><h4><a class="mozTocH4" name="mozTocId841934"></a>Build library files</h4>
Build libraries for all components marked as a static library. Only build files if they are older than the files they
are dependent on. If any project libraries were built, make symbols for them. Use the symbols to determine the project sort library order and which libraries should be used to link.<br>
<br><span style="background-color: rgb(204, 204, 204);"></span><span style="background-color: rgb(204, 204, 204);">[OPTIMIZE: Use more threads]</span><br style="background-color: rgb(204, 204, 204);">
<h4><a class="mozTocH4" name="mozTocId948888"></a>Build executables</h4>
Build executables for all components marked as executables. Sort the external libraries. Only build files if they are older than the files they
are dependent on.<br><br>

<h3><a class="mozTocH3" name="mozTocId510071"></a>Tasks performed by OovCppParser</h3><h4><a class="mozTocH4" name="mozTocId982586"></a>Scan project source</h4>Scan source for includes and drawing info. 
Compares age of XMI file to source files.<br>Function: srcFileParser::parseSrcFiles<br><br><div style="margin-left: 40px;">Output file: 
analysis-&lt;crc&gt;/*.xmi<br>Output file: analysis-&lt;crc&gt;/oovcde-incdeps (OovBuilder specifies the directory)<br></div><br>parser inserts includer, included<br>IncDirDependencyMap::write
		- includer, includer changed time, cur time, included dir, fn<br><br><h3><a class="mozTocH3" name="mozTocId172113"></a>Need to fix</h3><ul><li>Clean old analysis information if build arguments change. Currently multiple copies are stored so that switching arguments is quick, and multiple configurations may have different include path dependencies.&nbsp; If there are no configurations referring to some analysis information, and the information has not been used for some time, they could be cleaned up.<br></li></ul><h3><a class="mozTocH3" name="mozTocId260876"></a>Other optimizations</h3><ul><li>Any reason to store sources for each component?<br></li><li>Only link with used external packages</li><li>Delete old build info based on unused CRC's</li><li>Optimize incdeps.txt so updating is less frequent</li></ul><br>
</body>
